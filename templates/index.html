<!DOCTYPE html>
<!-- Define o idioma da página como Português do Brasil -->
<html lang="pt-br">
<head>
  <!-- Configurações essenciais do cabeçalho HTML -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Classificador de Emails - AutoU</title>

  <!-- Tailwind CSS: Framework de estilização para um design moderno e responsivo -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts: Importa a fonte 'Inter' para uma tipografia mais agradável -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Estilos CSS personalizados para complementar o Tailwind -->
  <style>
    /* Define a fonte 'Inter' como padrão para todo o corpo da página */
    body { font-family: 'Inter', sans-serif; }
    
    /* Animação de fade-in para as caixas de resultado e erro, melhorando a experiência do usuário */
    .result-box, .error-box { 
      animation: fadeIn 0.5s ease-in-out; 
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* O campo de chave de API começa escondido e só aparece quando necessário (controlado por JS) */
    #api_key_wrapper { 
      display: none; 
    }
  </style>
</head>

<!-- Corpo da página com o tema escuro restaurado -->
<body class="bg-gradient-to-br from-gray-900 via-gray-950 to-black text-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6">

  <!-- Container principal com estilo de vidro fosco (backdrop-blur) -->
  <div class="w-full max-w-2xl bg-gray-900/70 backdrop-blur-xl rounded-2xl shadow-2xl p-6 sm:p-8 space-y-8 border border-gray-800">

    <!-- Cabeçalho com o título e subtítulo -->
    <header class="text-center space-y-2">
      <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
        Classificador de Emails
      </h1>
      <p class="text-gray-400">Uma simulação do Case Prático AutoU 🚀</p>
    </header>

    <!-- Formulário principal para entrada de dados -->
    <form action="/process" method="POST" enctype="multipart/form-data" class="space-y-6">
      
      <!-- Campo de texto para colar o e-mail -->
      <div>
        <label for="text_input" class="block text-sm font-medium text-gray-300 mb-1">Cole o texto do e-mail aqui:</label>
        <textarea id="text_input" name="text_input" rows="8" 
          class="w-full p-3 rounded-lg border border-gray-700 bg-gray-800 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 placeholder-gray-500"
          placeholder="Ex: Olá, gostaria de saber o status do meu pedido 12345.">{{ original_text or '' }}</textarea>
      </div>

      <!-- Divisor visual "OU" -->
      <div class="relative flex items-center">
        <div class="flex-grow border-t border-gray-700"></div>
        <span class="flex-shrink mx-4 text-gray-500 text-sm">OU</span>
        <div class="flex-grow border-t border-gray-700"></div>
      </div>

      <!-- Campo para upload de arquivo -->
      <div>
        <label for="file" class="block text-sm font-medium text-gray-300 mb-1">Envie um arquivo (.txt ou .pdf):</label>
        <input type="file" id="file" name="file" accept=".txt,.pdf"
          class="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg 
          file:border-0 file:text-sm file:font-semibold file:bg-gradient-to-r file:from-blue-600 file:to-purple-600 file:text-white hover:file:opacity-90 transition">
      </div>

      <!-- Grid para organizar a seleção de modelo e o campo de chave de API -->
      <div class="grid sm:grid-cols-2 gap-4 items-end">
        
        <!-- Seletor de modelo de IA -->
        <div>
          <label for="mode" class="block text-sm font-medium text-gray-300 mb-1">Escolha o modelo de IA:</label>
          <select id="mode" name="mode"
            class="w-full p-3 border border-gray-700 bg-gray-800 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
            <option value="local">Modelo Local (Rápido e Offline)</option>
            <option value="gemini">Google Gemini</option>
            <option value="openai">OpenAI GPT</option>
          </select>
        </div>
        
        <!-- Campo para a chave de API (controlado por JavaScript) -->
        <div id="api_key_wrapper">
          <label for="api_key" class="block text-sm font-medium text-gray-300 mb-1">Chave de API:</label>
          <input type="password" id="api_key" name="api_key"
            class="w-full p-3 border border-gray-700 bg-gray-800 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            placeholder="Cole sua chave de API aqui">
        </div>
      </div>

      <!-- Botão de submissão do formulário -->
      <button type="submit"
        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-4 rounded-lg 
        hover:opacity-90 focus:outline-none focus:ring-4 focus:ring-blue-500/50 transition duration-150 text-lg">
        Analisar E-mail
      </button>
    </form>

    <!-- Seção de Erro: aparece apenas se a variável 'error' for enviada pelo Flask -->
    {% if error %}
    <div class="error-box bg-red-900/30 border-l-4 border-red-500 text-red-300 p-4 rounded-lg" role="alert">
      <p class="font-bold">Ocorreu um Erro</p>
      <p>{{ error }}</p>
    </div>
    {% endif %}

    <!-- Seção de Resultados: aparece apenas se a variável 'result_label' for enviada pelo Flask -->
    {% if result_label %}
    <div class="result-box space-y-6 pt-6 border-t border-gray-800">
      <h2 class="text-2xl font-bold text-center text-gray-100">Resultados da Análise</h2>

      <!-- Box para a classificação e confiança -->
      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700">
        <h3 class="font-semibold text-lg mb-2 text-gray-100">Classificação do E-mail:</h3>
        <div class="flex items-center space-x-3">
          <!-- A cor da tag de classificação muda se for 'Produtivo' ou 'Improdutivo' -->
          {% if result_label == 'Produtivo' %}
            <span class="px-3 py-1 text-sm font-medium bg-green-600/30 text-green-400 rounded-full">{{ result_label }}</span>
          {% else %}
            <span class="px-3 py-1 text-sm font-medium bg-yellow-600/30 text-yellow-400 rounded-full">{{ result_label }}</span>
          {% endif %}
          <!-- Exibe a confiança da classificação, formatada como porcentagem -->
          <span class="text-sm text-gray-400">(Confiança: {{ "%.1f"|format(confidence * 100) }}%)</span>
        </div>
      </div>

      <!-- Box para a resposta sugerida -->
      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700">
        <div class="flex justify-between items-center mb-2">
          <h3 class="font-semibold text-lg text-gray-100">Resposta Automática Sugerida:</h3>
          <!-- Botão para copiar o texto da resposta -->
          <button type="button" id="copyBtn"
            class="text-sm bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-1 px-3 rounded-lg hover:opacity-90 transition">
            Copiar
          </button>
        </div>
        <!-- O texto da resposta gerada pela IA ou pelo template -->
        <p id="suggested_reply_text" class="text-gray-200 whitespace-pre-wrap">{{ suggested_reply }}</p>
      </div>
    </div>
    {% endif %}

  </div> <!-- Fim do container principal -->

  <!-- Script JavaScript para funcionalidades da página -->
  <script>
    // Seleciona os elementos HTML que precisam de interatividade
    const modeSelector = document.getElementById('mode');
    const apiKeyWrapper = document.getElementById('api_key_wrapper');
    const copyBtn = document.getElementById('copyBtn');

    // Função para mostrar ou esconder o campo de chave de API
    function toggleApiKeyField() {
      // Se o modelo selecionado for 'gemini' ou 'openai', mostra o campo. Caso contrário, esconde.
      if (modeSelector.value === 'gemini' || modeSelector.value === 'openai') {
        apiKeyWrapper.style.display = 'block';
      } else {
        apiKeyWrapper.style.display = 'none';
      }
    }
    
    // Adiciona um 'ouvinte' que chama a função sempre que o seletor de modo é alterado
    modeSelector.addEventListener('change', toggleApiKeyField);
    // Chama a função uma vez quando a página carrega para definir o estado inicial correto
    document.addEventListener('DOMContentLoaded', toggleApiKeyField);

    // Adiciona a funcionalidade de cópia ao botão, se ele existir na página
    if (copyBtn) {
      copyBtn.addEventListener('click', () => {
        const replyText = document.getElementById('suggested_reply_text').innerText;
        // Usa a API do navegador para copiar o texto para a área de transferência
        navigator.clipboard.writeText(replyText).then(() => {
          // Muda o texto do botão para dar feedback ao usuário
          copyBtn.textContent = 'Copiado!';
          // Volta o texto do botão ao normal após 2 segundos
          setTimeout(() => { copyBtn.textContent = 'Copiar'; }, 2000);
        }).catch(err => {
          console.error('Erro ao copiar texto: ', err);
          copyBtn.textContent = 'Erro!';
        });
      });
    }
  </script>

</body>
</html>

