<!DOCTYPE html>
<!-- Define o idioma da p치gina como Portugu칡s do Brasil -->
<html lang="pt-br">
<head>
  <!-- Configura칞칫es essenciais do cabe칞alho HTML -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Classificador de Emails - AutoU</title>

  <!-- Tailwind CSS: Framework de estiliza칞칚o para um design moderno e responsivo -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts: Importa a fonte 'Inter' para uma tipografia mais agrad치vel -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Estilos CSS personalizados para complementar o Tailwind -->
  <style>
    /* Define a fonte 'Inter' como padr칚o para todo o corpo da p치gina */
    body { font-family: 'Inter', sans-serif; }
    
    /* Anima칞칚o de fade-in para as caixas de resultado e erro, melhorando a experi칡ncia do usu치rio */
    .result-box, .error-box { 
      animation: fadeIn 0.5s ease-in-out; 
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* O campo de chave de API come칞a escondido e s칩 aparece quando necess치rio (controlado por JS) */
    #api_key_wrapper { 
      display: none; 
    }
  </style>
</head>

<!-- Corpo da p치gina com o tema escuro restaurado -->
<body class="bg-gradient-to-br from-gray-900 via-gray-950 to-black text-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6">

  <!-- Container principal com estilo de vidro fosco (backdrop-blur) -->
  <div class="w-full max-w-2xl bg-gray-900/70 backdrop-blur-xl rounded-2xl shadow-2xl p-6 sm:p-8 space-y-8 border border-gray-800">

    <!-- Cabe칞alho com o t칤tulo e subt칤tulo -->
    <header class="text-center space-y-2">
      <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
        Classificador de Emails
      </h1>
      <p class="text-gray-400">Uma simula칞칚o do Case Pr치tico AutoU 游</p>
    </header>

    <!-- Formul치rio principal para entrada de dados -->
    <form action="/process" method="POST" enctype="multipart/form-data" class="space-y-6">
      
      <!-- Campo de texto para colar o e-mail -->
      <div>
        <label for="text_input" class="block text-sm font-medium text-gray-300 mb-1">Cole o texto do e-mail aqui:</label>
        <textarea id="text_input" name="text_input" rows="8" 
          class="w-full p-3 rounded-lg border border-gray-700 bg-gray-800 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 placeholder-gray-500"
          placeholder="Ex: Ol치, gostaria de saber o status do meu pedido 12345.">{{ original_text or '' }}</textarea>
      </div>

      <!-- Divisor visual "OU" -->
      <div class="relative flex items-center">
        <div class="flex-grow border-t border-gray-700"></div>
        <span class="flex-shrink mx-4 text-gray-500 text-sm">OU</span>
        <div class="flex-grow border-t border-gray-700"></div>
      </div>

      <!-- Campo para upload de arquivo -->
      <div>
        <label for="file" class="block text-sm font-medium text-gray-300 mb-1">Envie um arquivo (.txt ou .pdf):</label>
        <input type="file" id="file" name="file" accept=".txt,.pdf"
          class="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg 
          file:border-0 file:text-sm file:font-semibold file:bg-gradient-to-r file:from-blue-600 file:to-purple-600 file:text-white hover:file:opacity-90 transition">
      </div>

      <!-- Grid para organizar a sele칞칚o de modelo e o campo de chave de API -->
      <div class="grid sm:grid-cols-2 gap-4 items-end">
        
        <!-- Seletor de modelo de IA -->
        <div>
          <label for="mode" class="block text-sm font-medium text-gray-300 mb-1">Escolha o modelo de IA:</label>
          <select id="mode" name="mode"
            class="w-full p-3 border border-gray-700 bg-gray-800 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
            <option value="local">Modelo Local (R치pido e Offline)</option>
            <option value="gemini">Google Gemini</option>
            <option value="openai">OpenAI GPT</option>
          </select>
        </div>
        
        <!-- Campo para a chave de API (controlado por JavaScript) -->
        <div id="api_key_wrapper">
          <label for="api_key" class="block text-sm font-medium text-gray-300 mb-1">Chave de API:</label>
          <input type="password" id="api_key" name="api_key"
            class="w-full p-3 border border-gray-700 bg-gray-800 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            placeholder="Cole sua chave de API aqui">
        </div>
      </div>

      <!-- Bot칚o de submiss칚o do formul치rio -->
      <button type="submit"
        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-4 rounded-lg 
        hover:opacity-90 focus:outline-none focus:ring-4 focus:ring-blue-500/50 transition duration-150 text-lg">
        Analisar E-mail
      </button>
    </form>

    <!-- Se칞칚o de Erro: aparece apenas se a vari치vel 'error' for enviada pelo Flask -->
    {% if error %}
    <div class="error-box bg-red-900/30 border-l-4 border-red-500 text-red-300 p-4 rounded-lg" role="alert">
      <p class="font-bold">Ocorreu um Erro</p>
      <p>{{ error }}</p>
    </div>
    {% endif %}

    <!-- Se칞칚o de Resultados: aparece apenas se a vari치vel 'result_label' for enviada pelo Flask -->
    {% if result_label %}
    <div class="result-box space-y-6 pt-6 border-t border-gray-800">
      <h2 class="text-2xl font-bold text-center text-gray-100">Resultados da An치lise</h2>

      <!-- Box para a classifica칞칚o e confian칞a -->
      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700">
        <h3 class="font-semibold text-lg mb-2 text-gray-100">Classifica칞칚o do E-mail:</h3>
        <div class="flex items-center space-x-3">
          <!-- A cor da tag de classifica칞칚o muda se for 'Produtivo' ou 'Improdutivo' -->
          {% if result_label == 'Produtivo' %}
            <span class="px-3 py-1 text-sm font-medium bg-green-600/30 text-green-400 rounded-full">{{ result_label }}</span>
          {% else %}
            <span class="px-3 py-1 text-sm font-medium bg-yellow-600/30 text-yellow-400 rounded-full">{{ result_label }}</span>
          {% endif %}
          <!-- Exibe a confian칞a da classifica칞칚o, formatada como porcentagem -->
          <span class="text-sm text-gray-400">(Confian칞a: {{ "%.1f"|format(confidence * 100) }}%)</span>
        </div>
      </div>

      <!-- Box para a resposta sugerida -->
      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700">
        <div class="flex justify-between items-center mb-2">
          <h3 class="font-semibold text-lg text-gray-100">Resposta Autom치tica Sugerida:</h3>
          <!-- Bot칚o para copiar o texto da resposta -->
          <button type="button" id="copyBtn"
            class="text-sm bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-1 px-3 rounded-lg hover:opacity-90 transition">
            Copiar
          </button>
        </div>
        <!-- O texto da resposta gerada pela IA ou pelo template -->
        <p id="suggested_reply_text" class="text-gray-200 whitespace-pre-wrap">{{ suggested_reply }}</p>
      </div>
    </div>
    {% endif %}

  </div> <!-- Fim do container principal -->

  <!-- Script JavaScript para funcionalidades da p치gina -->
  <script>
    // Seleciona os elementos HTML que precisam de interatividade
    const modeSelector = document.getElementById('mode');
    const apiKeyWrapper = document.getElementById('api_key_wrapper');
    const copyBtn = document.getElementById('copyBtn');

    // Fun칞칚o para mostrar ou esconder o campo de chave de API
    function toggleApiKeyField() {
      // Se o modelo selecionado for 'gemini' ou 'openai', mostra o campo. Caso contr치rio, esconde.
      if (modeSelector.value === 'gemini' || modeSelector.value === 'openai') {
        apiKeyWrapper.style.display = 'block';
      } else {
        apiKeyWrapper.style.display = 'none';
      }
    }
    
    // Adiciona um 'ouvinte' que chama a fun칞칚o sempre que o seletor de modo 칠 alterado
    modeSelector.addEventListener('change', toggleApiKeyField);
    // Chama a fun칞칚o uma vez quando a p치gina carrega para definir o estado inicial correto
    document.addEventListener('DOMContentLoaded', toggleApiKeyField);

    // Adiciona a funcionalidade de c칩pia ao bot칚o, se ele existir na p치gina
    if (copyBtn) {
      copyBtn.addEventListener('click', () => {
        const replyText = document.getElementById('suggested_reply_text').innerText;
        // Usa a API do navegador para copiar o texto para a 치rea de transfer칡ncia
        navigator.clipboard.writeText(replyText).then(() => {
          // Muda o texto do bot칚o para dar feedback ao usu치rio
          copyBtn.textContent = 'Copiado!';
          // Volta o texto do bot칚o ao normal ap칩s 2 segundos
          setTimeout(() => { copyBtn.textContent = 'Copiar'; }, 2000);
        }).catch(err => {
          console.error('Erro ao copiar texto: ', err);
          copyBtn.textContent = 'Erro!';
        });
      });
    }
  </script>

</body>
</html>

