<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Classificador de Emails - AutoU</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .result-box,
    .error-box {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #api_key_wrapper {
      display: none;
    }

    /* Anima칞칚o blobs */
    @keyframes blob {
      0% {
        transform: scale(1) translate(0px, 0px);
      }

      33% {
        transform: scale(1.1) translate(30px, -50px);
      }

      66% {
        transform: scale(0.9) translate(-20px, 20px);
      }

      100% {
        transform: scale(1) translate(0px, 0px);
      }
    }

    /* Estrelas piscando */
    @keyframes twinkle {

      0%,
      100% {
        opacity: 0.2;
      }

      50% {
        opacity: 1;
      }
    }

    /* Reflexo sutil no card */
    .card-glass::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 35%;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.15), transparent);
      border-radius: inherit;
      pointer-events: none;
    }
  </style>
</head>

<body
  class="bg-gradient-to-br from-gray-900 via-gray-950 to-black text-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 overflow-hidden relative">

  <div class="absolute inset-0 w-full h-full z-0 overflow-hidden">
    <div class="absolute top-0 -left-10 w-80 h-80 md:w-[30rem] md:h-[30rem]
          bg-purple-600 rounded-full mix-blend-screen filter blur-3xl opacity-20
          animate-[blob_28s_infinite]"></div>

    <div class="absolute top-0 -right-10 w-80 h-80 md:w-[30rem] md:h-[30rem]
          bg-blue-500 rounded-full mix-blend-screen filter blur-3xl opacity-20
          animate-[blob_30s_infinite_reverse]"></div>

    <div class="absolute bottom-0 left-20 w-80 h-80 md:w-[30rem] md:h-[30rem]
          bg-cyan-500 rounded-full mix-blend-screen filter blur-3xl opacity-15
          animate-[blob_34s_infinite]"></div>

    <div class="absolute bottom-0 right-20 w-80 h-80 md:w-[30rem] md:h-[30rem]
          bg-indigo-600 rounded-full mix-blend-screen filter blur-3xl opacity-15
          animate-[blob_32s_infinite]"></div>

    <div
      class="absolute top-1/3 left-1/3 w-24 h-24 bg-indigo-400 rounded-full mix-blend-screen filter blur-2xl opacity-10 animate-[blob_40s_infinite]">
    </div>
    <div
      class="absolute top-2/3 right-1/3 w-20 h-20 bg-blue-400 rounded-full mix-blend-screen filter blur-2xl opacity-10 animate-[blob_36s_infinite_reverse]">
    </div>
    <div
      class="absolute bottom-1/3 left-1/2 w-16 h-16 bg-cyan-300 rounded-full mix-blend-screen filter blur-2xl opacity-10 animate-[blob_42s_infinite]">
    </div>
    <div
      class="absolute top-1/2 right-1/2 w-16 h-16 bg-purple-400 rounded-full mix-blend-screen filter blur-2xl opacity-10 animate-[blob_38s_infinite_reverse]">
    </div>

    <div
      class="absolute top-[45%] left-[38%] w-10 h-10 bg-purple-500 rounded-full mix-blend-screen filter blur-xl opacity-20 animate-[blob_35s_infinite]">
    </div>
    <div
      class="absolute top-[42%] left-[62%] w-8 h-8 bg-cyan-400 rounded-full mix-blend-screen filter blur-lg opacity-20 animate-[blob_37s_infinite_reverse]">
    </div>
    <div
      class="absolute bottom-[40%] left-[47%] w-12 h-12 bg-blue-500 rounded-full mix-blend-screen filter blur-xl opacity-15 animate-[blob_39s_infinite]">
    </div>
    <div
      class="absolute bottom-[43%] right-[47%] w-9 h-9 bg-indigo-400 rounded-full mix-blend-screen filter blur-lg opacity-20 animate-[blob_41s_infinite_reverse]">
    </div>

    <div class="absolute left-[12%] top-[25%] w-36 h-36 bg-purple-400/30 rounded-full blur-[80px]"></div>
    <div class="absolute left-[8%] top-[50%] w-20 h-20 bg-pink-400/30 rounded-full blur-[50px]"></div>
    <div class="absolute left-[15%] top-[72%] w-28 h-28 bg-blue-400/25 rounded-full blur-[60px]"></div>

    <div class="absolute right-[12%] top-[28%] w-32 h-32 bg-purple-400/30 rounded-full blur-[75px]"></div>
    <div class="absolute right-[9%] top-[52%] w-24 h-24 bg-pink-400/30 rounded-full blur-[55px]"></div>
    <div class="absolute right-[16%] top-[75%] w-40 h-40 bg-blue-400/20 rounded-full blur-[90px]"></div>

    <div class="absolute inset-0">
      <div class="absolute top-10 left-1/4 w-1 h-1 bg-yellow-300 rounded-full animate-[twinkle_4s_infinite]"></div>
      <div class="absolute top-1/3 left-2/3 w-0.5 h-0.5 bg-yellow-200 rounded-full animate-[twinkle_6s_infinite]"></div>
      <div class="absolute top-1/2 left-1/5 w-1 h-1 bg-white rounded-full animate-[twinkle_5s_infinite_reverse]"></div>
      <div class="absolute bottom-1/3 right-1/4 w-0.5 h-0.5 bg-white rounded-full animate-[twinkle_7s_infinite]"></div>
      <div class="absolute bottom-20 left-1/2 w-1 h-1 bg-yellow-100 rounded-full animate-[twinkle_8s_infinite]"></div>

      <div class="absolute top-[48%] left-[44%] w-1 h-1 bg-yellow-200 rounded-full animate-[twinkle_9s_infinite]"></div>
      <div
        class="absolute top-[52%] left-[56%] w-0.5 h-0.5 bg-white rounded-full animate-[twinkle_10s_infinite_reverse]">
      </div>
      <div class="absolute top-[40%] left-[53%] w-1 h-1 bg-yellow-300 rounded-full animate-[twinkle_11s_infinite]">
      </div>
      <div class="absolute top-[57%] left-[46%] w-1 h-1 bg-white rounded-full animate-[twinkle_12s_infinite_reverse]">
      </div>
      <div class="absolute top-[62%] left-[51%] w-0.5 h-0.5 bg-yellow-200 rounded-full animate-[twinkle_13s_infinite]">
      </div>
      <div
        class="absolute bottom-[35%] left-[42%] w-1 h-1 bg-white rounded-full animate-[twinkle_14s_infinite_reverse]">
      </div>
      <div
        class="absolute bottom-[37%] right-[42%] w-0.5 h-0.5 bg-yellow-100 rounded-full animate-[twinkle_15s_infinite]">
      </div>
      <div class="absolute top-[5%] left-[15%] w-1 h-1 bg-white rounded-full animate-[twinkle_7s_infinite_reverse]">
      </div>
      <div class="absolute top-[8%] right-[20%] w-1 h-1 bg-yellow-200 rounded-full animate-[twinkle_6s_infinite]"></div>
      <div
        class="absolute top-[12%] left-[35%] w-0.5 h-0.5 bg-yellow-100 rounded-full animate-[twinkle_8s_infinite_reverse]">
      </div>
      <div class="absolute top-[18%] right-[30%] w-1 h-1 bg-white rounded-full animate-[twinkle_9s_infinite]"></div>
      <div class="absolute top-[45%] left-[10%] w-1 h-1 bg-yellow-300 rounded-full animate-[twinkle_12s_infinite]">
      </div>
      <div
        class="absolute top-[55%] right-[12%] w-0.5 h-0.5 bg-white rounded-full animate-[twinkle_11s_infinite_reverse]">
      </div>
      <div class="absolute bottom-[10%] left-[20%] w-1 h-1 bg-yellow-200 rounded-full animate-[twinkle_10s_infinite]">
      </div>
      <div
        class="absolute bottom-[15%] right-[25%] w-1 h-1 bg-white rounded-full animate-[twinkle_13s_infinite_reverse]">
      </div>
      <div
        class="absolute bottom-[18%] left-[40%] w-0.5 h-0.5 bg-yellow-100 rounded-full animate-[twinkle_14s_infinite]">
      </div>
      <div
        class="absolute bottom-[22%] right-[40%] w-1 h-1 bg-white rounded-full animate-[twinkle_15s_infinite_reverse]">
      </div>
    </div>
  </div>

  <div
    class="w-full max-w-2xl bg-white/10 backdrop-blur-xl rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0.6)] p-6 sm:p-8 space-y-8 border border-white/20 relative z-20 card-glass">

    <header class="text-center space-y-2">
      <h1
        class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 drop-shadow-lg">
        Classificador de Emails
      </h1>
      <p class="text-gray-300 drop-shadow">Uma simula칞칚o do Case Pr치tico AutoU 游</p>
    </header>

    <form action="/process" method="POST" enctype="multipart/form-data" class="space-y-6">
      <div>
        <label for="text_input" class="block text-sm font-medium text-gray-200 mb-1">Cole o texto do e-mail
          aqui:</label>
        <textarea id="text_input" name="text_input" rows="8"
          class="w-full p-3 rounded-lg border border-gray-700 bg-gray-900/60 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 placeholder-gray-400"
          placeholder="Ex: Ol치, gostaria de saber o status do meu pedido 12345.">{{ original_text or '' }}</textarea>
      </div>

      <div class="relative flex items-center">
        <div class="flex-grow border-t border-gray-600"></div>
        <span class="flex-shrink mx-4 text-gray-400 text-sm">OU</span>
        <div class="flex-grow border-t border-gray-600"></div>
      </div>

      <div>
        <label for="file" class="block text-sm font-medium text-gray-200 mb-1">Envie um arquivo (.txt ou .pdf):</label>
        <input type="file" id="file" name="file" accept=".txt,.pdf"
          class="w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg 
            file:border-0 file:text-sm file:font-semibold file:bg-gradient-to-r file:from-blue-600 file:to-purple-600 file:text-white hover:file:opacity-90 transition">
      </div>

      <div class="grid sm:grid-cols-2 gap-4 items-end">
        <div>
          <label for="mode" class="block text-sm font-medium text-gray-200 mb-1">Escolha o modelo de IA:</label>
          <select id="mode" name="mode"
            class="w-full p-3 border border-gray-700 bg-gray-900/60 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
            <option value="local">Modelo Local (R치pido e Offline)</option>
            <option value="gemini">Google Gemini</option>
            <option value="openai">OpenAI GPT</option>
          </select>
        </div>

        <div id="api_key_wrapper">
          <label for="api_key" class="block text-sm font-medium text-gray-200 mb-1">Chave de API:</label>
          <input type="password" id="api_key" name="api_key"
            class="w-full p-3 border border-gray-700 bg-gray-900/60 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            placeholder="Cole sua chave de API aqui">
        </div>
      </div>

      <button type="submit"
        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-4 rounded-lg 
        hover:opacity-90 focus:outline-none focus:ring-4 focus:ring-blue-500/50 transition duration-150 text-lg shadow-lg">
        Analisar E-mail
      </button>
    </form>

    {% if error %}
    <div class="error-box bg-red-900/40 border-l-4 border-red-500 text-red-200 p-4 rounded-lg backdrop-blur-sm"
      role="alert">
      <p class="font-bold">Ocorreu um Erro</p>
      <p>{{ error }}</p>
    </div>
    {% endif %}

    {% if result_label %}
    <div class="result-box space-y-6 pt-6 border-t border-gray-700">
      <h2 class="text-2xl font-bold text-center text-gray-100 drop-shadow">Resultados da An치lise</h2>

      <div class="bg-gray-900/60 p-4 rounded-lg border border-gray-700 backdrop-blur-sm">
        <h3 class="font-semibold text-lg mb-2 text-gray-100">Classifica칞칚o do E-mail:</h3>
        <div class="flex items-center space-x-3">
          {% if result_label == 'Produtivo' %}
          <span class="px-3 py-1 text-sm font-medium bg-green-600/30 text-green-400 rounded-full">{{ result_label
            }}</span>
          {% else %}
          <span class="px-3 py-1 text-sm font-medium bg-yellow-600/30 text-yellow-400 rounded-full">{{ result_label
            }}</span>
          {% endif %}
          <span class="text-sm text-gray-400">(Confian칞a: {{ (confidence*100)|round(1) }}%)</span>
        </div>

        <div class="mt-3">
          <span class="text-sm text-gray-300">Confian칞a do modelo:</span>
          <div class="w-full bg-gray-700 rounded-full h-5 overflow-hidden mt-1">
            <div class="h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center"
              style="width: {{ (confidence * 100)|round(1) }}%;">
                <span class="text-xs font-bold text-white">
                    {{ (confidence * 100)|round(1) }}%
                </span>
            </div>
          </div>
        </div>
        </div>

      <div class="bg-gray-900/60 p-4 rounded-lg border border-gray-700 backdrop-blur-sm">
        <div class="flex justify-between items-center mb-2">
          <h3 class="font-semibold text-lg text-gray-100">Resposta Autom치tica Sugerida:</h3>
          <button type="button" id="copyBtn"
            class="text-sm bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-1 px-3 rounded-lg hover:opacity-90 transition">
            Copiar
          </button>
        </div>
        <p id="suggested_reply_text" class="text-gray-200 whitespace-pre-wrap">{{ suggested_reply }}</p>
      </div>
    </div>

    {% endif %}

  </div>

  <script>
    const modeSelector = document.getElementById('mode');
    const apiKeyWrapper = document.getElementById('api_key_wrapper');
    const copyBtn = document.getElementById('copyBtn');

    function toggleApiKeyField() {
      if (modeSelector.value === 'gemini' || modeSelector.value === 'openai') {
        apiKeyWrapper.style.display = 'block';
      } else {
        apiKeyWrapper.style.display = 'none';
      }
    }

    modeSelector.addEventListener('change', toggleApiKeyField);
    document.addEventListener('DOMContentLoaded', toggleApiKeyField);

    if (copyBtn) {
      copyBtn.addEventListener('click', () => {
        const replyText = document.getElementById('suggested_reply_text').innerText;
        navigator.clipboard.writeText(replyText).then(() => {
          copyBtn.textContent = 'Copiado!';
          setTimeout(() => { copyBtn.textContent = 'Copiar'; }, 2000);
        }).catch(err => {
          console.error('Erro ao copiar texto: ', err);
          copyBtn.textContent = 'Erro!';
        });
      });
    }
  </script>

</body>

</html>